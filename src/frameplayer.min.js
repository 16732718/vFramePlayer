/**
 * frameplayer v0.1.0
 *
 * https://github.com/vmllab-js/FramePlayer | Released under MIT license
 *
 * @author vmllab
 * @since 2017-06-02
 * @link http://vmllab.im20.com.cn
 */
(function(e,t){"use strict";if(typeof module==="object"&&typeof module.exports==="object"){module.exports=t(e,true)}else{t(e)}})(typeof window!=="undefined"?window:this,function(e,t){"use strict";var i=e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame||e.msRequestAnimationFrame||function(t){e.setTimeout(t,1e3/60)};var r=function(e){var t=this;if(!e){console.log("请设置参数！");return}this.dom=e.dom;this.startFrame=0;this.endFrame=e.imgArr.length-1;this.curFrame=0;this.prevFrame=0;this.fps=e.fps||25;this.useCanvas=e.useCanvas?true:false;this.loop=e.loop||0;this.yoyo=e.yoyo?true:false;this._imgObjArr=[];this._events={};this._isPng=true;this._isPlay=false;this._times=0;this._asc=true;this._temp={};for(var i in e.imgArr){var r=new Image;r.src=e.imgArr[i];this._imgObjArr.push(r)}this.init()};var s=function(e,t){if(e.complete){t()}else{e.onload=function(){t()}}};r.prototype={init:function(){var e=this;this.dom.textContent="";if(e.useCanvas){var t=document.createElement("canvas");t.width=t.height=0;t.style.width=t.style.height="100%";this.ctx=t.getContext("2d");this.dom.appendChild(t);var i=function(){e._isPng=/(\.png(\?|$))|(image\/png;base64)/.test(e._imgObjArr[0].src);e.width=t.width=e._imgObjArr[0].width;e.height=t.height=e._imgObjArr[0].height};s(this._imgObjArr[0],i)}else{e.mc=document.createElement("div");e.mc.setAttribute("class","mc");e.mc.style.width=e.mc.style.height="100%";this.dom.appendChild(e.mc);for(var r=0;r<this._imgObjArr.length;r++){this._imgObjArr[r].style.opacity=0;this._imgObjArr[r].style.position="absolute";this._imgObjArr[r].style.width=this._imgObjArr[r].style.height="100%";this._imgObjArr[r].style.top=this._imgObjArr[r].style.left=0;e.mc.appendChild(this._imgObjArr[r])}}},set:function(e,t){var i=this._temp;if(arguments.length===1&&typeof arguments[0]==="object"){for(var r in arguments[0]){this[r]=arguments[0][r]}}if(arguments.length===2){this[arguments[0]]=arguments[1]}if(e==="useCanvas"){this.init()}if(e==="fps"){if(this._isPlay){clearInterval(this._interval);this._process(i.onUpdate,i.onComplete)}}if(e==="startFrame"){if(!this._isPlay){this.curFrame=this.startFrame}}},get:function(e){return this[e]},play:function(e,t,i){if(this._isPlay)return;var r=this;var s=0;var a,n;for(var o in arguments){switch(typeof arguments[o]){case"number":if(s==0){r.set("startFrame",arguments[o]);s++}else{r.set("endFrame",arguments[o])}break;case"object":if(arguments[o].onComplete)a=arguments[o].onComplete;delete arguments[o].onComplete;if(arguments[o].onUpdate)n=arguments[o].onUpdate;delete arguments[o].onUpdate;r.set(arguments[o]);break}}r._temp.onComplete=a;r._temp.onUpdate=n;r._asc=r.startFrame<r.endFrame;if(!r._isPlay)this.trigger("play");this._process(n,a)},_process:function(e,t){var i=this;this._interval=setInterval(function(){if(i._imgObjArr[i.curFrame].complete){if(i.useCanvas){if(i._isPng)i.ctx.clearRect(0,0,i.width,i.height);i.ctx.drawImage(i._imgObjArr[i.curFrame],0,0,i.width,i.height)}else{i.mc.childNodes[i.prevFrame].style.opacity=0;i.mc.childNodes[i.curFrame].style.opacity=1}i.prevFrame=i.curFrame;i.trigger("update",i.curFrame,i._times+1,i._asc);if(e)e(i.curFrame,i._times+1,i._asc);if((i.curFrame==i.endFrame||i.curFrame==i.startFrame)&&i._isPlay&&!i._temp.repeat){if(i.loop&&(i._times+1<i.loop||i.loop==-1)){if(i.yoyo){if(i._asc){i.curFrame=Math.max(i.startFrame,i.endFrame)-1}else{i.curFrame=Math.min(i.startFrame,i.endFrame)+1}i._asc=!i._asc}else{i._temp.repeat=true;if(i._asc){i.curFrame=Math.min(i.startFrame,i.endFrame)}else{i.curFrame=Math.max(i.startFrame,i.endFrame)}}i._times++}else{i.stop();if(t)t()}}else{if(i._asc){i.curFrame++}else{i.curFrame--}i._isPlay=true;i._temp.repeat=false}}},1e3/this.fps)},goto:function(e){var t=this;this.curFrame=e;var i=function(){if(t.useCanvas){if(t._isPng)t.ctx.clearRect(0,0,t.width,t.height);t.ctx.drawImage(t._imgObjArr[t.curFrame],0,0,t.width,t.height)}else{t.mc.childNodes[t.prevFrame].style.opacity=0;t.mc.childNodes[t.curFrame].style.opacity=1}t.trigger("update",t.curFrame,t._times+1,t._asc)};s(this._imgObjArr[this.curFrame],i)},pause:function(){this._isPlay=false;this.trigger("pause");clearInterval(this._interval)},stop:function(){this._isPlay=false;this.trigger("stop");this.curFrame=this.startFrame;clearInterval(this._interval);this._times=0},on:function(e,t){e=e.split(" ");for(var i=0;i<e.length;++i){if(!this._events[e[i]])this._events[e[i]]=[];this._events[e[i]].unshift(t)}return this},one:function(e,t){var i=function(){t();this.off(e,i)};return this.on(e,i)},off:function(e,t){if(e){e=e.split(" ");var i=this._events;for(var r=0;r<e.length;++r){if(!i[e[r]])continue;if(!t){i[e[r]]=[]}else{for(var s=i[e[r]].length-1;s>=0;--s){if(i[e[r]][s]==t)i[e[r]].splice(s,1)}}}}else{this._events={}}return this},trigger:function(){var e=Array.prototype.shift.call(arguments);e=e.split(" ");for(var t=0;t<e.length;++t){if(this._events[e[t]]){for(var i=this._events[e[t]].length-1;i>=0;--i){try{this._events[e[t]][i].apply(this,arguments)}catch(e){console.log(e)}}}}return this},destroy:function(){clearInterval(this._interval);this.off()}};if(typeof define==="function"&&define.amd){define("FramePlayer",[],function(){return r})}else{e.FramePlayer=r}return r});